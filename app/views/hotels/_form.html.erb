<div class="row">
  <div class="col-lg-10">
    <div class="ibox float-e-margins">
      <div class="ibox-title">
       <h2><%= @hotel.new_record? ?   "Создать новый отель" : "Изменить отель: #{@hotel.name}" %></h2>
      </div>
      <div class="ibox-content">
            <div class="tabs-container">
              <%= form_for @hotel do |f| %>
              <%= f.submit @hotel.new_record? ?  'Создать' : 'Сохранить' , class: 'btn btn-primary btn-outline btn-lg pull-right' %>
              <%= link_to  'Назад', :back, class: 'btn btn-default btn-outline pull-right' %>
              <% if @hotel.id != nil %>
                  <%= link_to 'Удалить' , hotel_path(@hotel),  method: :delete, class: 'btn btn-danger  pull-right', data: {confirm: 'Вы уверены?'} %>
              <% end %>
              <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#tab-1"> Общая информация</a></li>
                <li class=""><a data-toggle="tab" href="#tab-2">Фото</a></li>
                <li class=""><a data-toggle="tab" href="#tab-3">Услуги</a></li>
                <li class=""><a data-toggle="tab" href="#tab-4">Номера и цены</a></li>
              </ul>

                  <div class="tab-content">

                    <div id="tab-1" class="tab-pane active">
                      <div class="panel-body">


                            <div class="form-group">
                              <%= f.label 'Регион' %>

                              <%= f.collection_select :region_id, Region.order(:name), :id, :name, {prompt: "Выберете регион"}, class: "form-control" , include_blank: true %>
                            </div>
                            <div class="form-group">
                              <%= f.label 'Город' %>
                              <%= f.grouped_collection_select :town_id, Region.order(:name), :towns, :name, :id, :name,{prompt: "Выберете город"} , class: "form-control" ,include_blank: true %>
                            </div>
                            <div class="form-group">
                              <%= f.label :name %>
                              <%= f.text_field :name, class: "form-control" %>
                            </div>
                            <div class="form-group">
                              <%= f.label :transcription %>
                              <%= f.text_area :transcription, class: "form-control" %>
                            </div>


                    </div>
                  </div>
                  <div id="tab-2" class="tab-pane">
                    <div class="panel-body">
                      <div class="lightBoxGallery">
                        <% @hotel.images.each do |g|%>
                            <a href="<%= image_path("#{g.url}") %>" title="<%= @hotel.name  %>" data-gallery=""><img src="<%= image_path("#{g.url(:thumb)}") %>"></a>
                        <% end %>


                      <!-- The Gallery as lightbox dialog, should be a child element of the document body -->
                      <div id="blueimp-gallery" class="blueimp-gallery">
                        <div class="slides"></div>
                        <h3 class="title"></h3>
                        <a class="prev">‹</a>
                        <a class="next">›</a>
                        <a class="close">×</a>
                        <a class="play-pause"></a>
                        <ol class="indicator"></ol>
                      </div>

                    </div>

                      <%= f.file_field :images, multiple: true %>



                    </div>
                  </div>
                  <div id="tab-3" class="tab-pane">
                    <div class="panel-body">
                      <div class="col-lg-8">
                        <%= f.collection_check_boxes(:service_ids, Service.all, :id, :name) do |b| %>
                            <div class="row">
                              <div class="checkbox checkbox-primary">
                                <%= b.check_box(class: "check_box") %>
                                <%= b.label(class: "check_box") do %>
                                    <%= b.object.name %>
                                <% end %>
                              </div>
                            </div>
                        <% end %>
                      </div>
                    </div>

                </div>
                <div id="tab-4" class="tab-pane">
               <h3>Numbers</h3>
                  <div id="numbers">
                    <%= f.fields_for :numbers do |number|%>
                        <%= render 'number_fields', f: number %>
                    <% end %>
                    <div class="links">
                      <%= link_to_add_association 'add number', f, :numbers%>
                    </div>
                  </div>
                </div>
              </div>
              <% end %>
            </div>
          </div>
    </div>
  </div>
</div>


<script>
    jQuery(function() {
        var towns;
        $('#hotel_town_id').parent().hide();
        towns = $('#hotel_town_id').html();
        console.log(towns);
        return $('#hotel_region_id').change(function() {
            var region, escaped_region, options;
            region = $('#hotel_region_id :selected').text();
            escaped_region = region.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g, '\\$1');
            options = $(towns).filter("optgroup[label=" + escaped_region + "]").html();
            console.log(options);
            if (options) {
                $('#hotel_town_id').html(options);
                return $('#hotel_town_id').parent().show();
            } else {
                $('#hotel_town_id').empty();
                return $('#hotel_town_id').parent().hide();
            }
        });
    });

</script>


